#!/bin/bash

#------------------------------------------------------------------------------#
# For download files by specific user defnied options.
# Second bash to be executed.
# After fix_noaa

# To select year.
# To change format.

#------------------------------------------------------------------------------#
# float number comparison
function tf_1_lt_2() {
  echo "$1<$2" | bc
}

#------------------------------------------------------------------------------#
year_min=1990

#------------------------------------------------------------------------------#
FI=./WOD_fixed.csv
FO1=./z.txt
FO2=./T.txt
FO3=./S.txt

rm $FO1
>$FO1

rm $FO2
>$FO2

rm $FO3
>$FO3

#------------------------------------------------------------------------------#
#------------------------------------------------------------------------------#
#------------------------------------------------------------------------------#
IFS=,

i=1
data=0
tf=0
while read line; do
	
	#----------------------------------------------------------------------------#
	# read header
	if [ "$data" -eq "0" ]; then
		
		# read year
		if [ "$i" -eq "8" ]; then
			year="$(echo $line | sed -e "s/,//g" | sed -e "s/Year//g" | sed -e "s/ //g" )"
			tf="$(tf_1_lt_2 "$year_min" "$year")"
		fi
		
		# year ok?
		if [ "$tf" -eq "1" ]; then
			data="$(echo $line | grep -c "Prof-Flag")"
#			if [ "$i" -eq "23" ]; then
#				data=1
#				echo $year
#			fi
		fi
		
	#----------------------------------------------------------------------------#
	# read data
	else
		
		#----------------------#
	  # split into an array
    field=( $line )
		
		# write data
	  l1="$(echo ${field[1]} | sed -e "s/ //g" )"
	  l2="$(echo ${field[4]} | sed -e "s/ //g" )"
	  l3="$(echo ${field[7]} | sed -e "s/ //g" )"
		echo -e "$l1 \c" >> $FO1
		echo -e "$l2 \c" >> $FO2
		echo -e "$l3 \c" >> $FO3
		
	#----------------------------------------------------------------------------#
	fi
	
	#---------------------------------------------#
	# last line of data?
	last="$(echo $line | grep -c "END OF VARIABLES SECTION")"
	if [ "$last" -eq "1" ]; then
	  i=0
	  if [ "$data" -eq "1" ]; then
			echo >> $FO1
			echo >> $FO2
			echo >> $FO3
		fi
	  data=0
	fi
	
	#---------------------------------------------#
  i=$[$i+1]
  
done < $FI



#------------------------------------------------------------------------------#
#------------------------------------------------------------------------------#
#------------------------------------------------------------------------------#
exit 0





