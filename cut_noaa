#!/bin/bash

#------------------------------------------------------------------------------#
# For download files by specific user defnied options.
# Third bash to be executed.
# After format_noaa

# Select XBT with enought mesurements.

#------------------------------------------------------------------------------#
z_max=1800
z_min=5

#------------------------------------------------------------------------------#
# float number comparison
function tf_1_lt_2() {
  echo "$1<$2" | bc
}

#------------------------------------------------------------------------------#
FI1=./z.txt
FI2=./T.txt
FI3=./S.txt

FO1=./z2.txt
FO2=./T2.txt
FO3=./S2.txt
FO4=./lines.txt

rm $FO1
>$FO1

rm $FO2
>$FO2

rm $FO3
>$FO3

rm $FO4
>$FO4

#------------------------------------------------------------------------------#
#------------------------------------------------------------------------------#
#------------------------------------------------------------------------------#

IFS=' '
k=0
while read -r line; do

	#---------------------------------------------#
	# 
	k=$[$k+1]
	
	#---------------------------------------------#
	# split into an array
  field=( $line )
  
#	# split into an array
#	# ${string//substring/replacement}
#	field=( ${line//,/ } )
	
	#---------------------------------------------#
	# Check range
  z_bot="$(echo ${field[${#field[@]}-1]} | sed -e "s/ //g" )"
  z_top="$(echo ${field[0]} | sed -e "s/ //g" )"
  
  tf="$(tf_1_lt_2 "$z_max" "$z_bot")"
  if [ "$tf" -eq "1" ]; then
		tf="$(tf_1_lt_2 "$z_top" "$z_min")"
		if [ "$tf" -eq "1" ]; then
		
		  # z
		  echo $line >> $FO1
		  
		  # T
		  sed -n "${k}p" $FI2 >> $FO2
		  
		  # S
		  sed -n "${k}p" $FI3 >> $FO3
		  
		  # numero de lineas
		  echo ${#field[@]} >> $FO4
		  
		fi
  fi
  
	#---------------------------------------------#
  
done < $FI1

#------------------------------------------------------------------------------#
#------------------------------------------------------------------------------#
#------------------------------------------------------------------------------#
exit 0












